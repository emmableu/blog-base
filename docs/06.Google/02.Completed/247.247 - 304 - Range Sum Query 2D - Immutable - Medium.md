---
title: 247 -  304-Range Sum Query 2D - Immutable
date: 2021-09-21 15:33:13
permalink: /pages/a7fa8a/
categories:
  
tags:
  - prefix sum
  - 近期面经
---
[LC link](https://leetcode.com/problems/range-sum-query-2d-immutable/)
[explanation](https://leetcode-cn.com/problems/range-sum-query-2d-immutable/solution/ru-he-qiu-er-wei-de-qian-zhui-he-yi-ji-y-6c21/)
## Description
Given a 2D matrix matrix, handle multiple queries of the following type:

Calculate the sum of the elements of matrix inside the rectangle defined by its upper left corner (`row1`, `col1`) and lower right corner (`row2`, `col2`).

Implement the `NumMatrix` class:
- `NumMatrix(int[][] matrix)` Initializes the object with the integer matrix matrix.
- `int sumRegion(int row1, int col1, int row2, int col2)` Returns the sum of the elements of matrix inside the rectangle defined by its upper left corner (row1, col1) and lower right corner (row2, col2).
 

## Example
```
Input
["NumMatrix", "sumRegion", "sumRegion", "sumRegion"]
[[[[3, 0, 1, 4, 2], 
   [5, 6, 3, 2, 1],
   [1, 2, 0, 1, 5], 
   [4, 1, 0, 1, 7], 
   [1, 0, 3, 0, 5]]], 
   
   [2, 1, 4, 3], 
   [1, 1, 2, 2], 
   [1, 2, 2, 4]]
Output
[null, 8, 11, 12]

Explanation
NumMatrix numMatrix = new NumMatrix([[3, 0, 1, 4, 2], [5, 6, 3, 2, 1], [1, 2, 0, 1, 5], [4, 1, 0, 1, 7], [1, 0, 3, 0, 5]]);
numMatrix.sumRegion(2, 1, 4, 3); // return 8 
numMatrix.sumRegion(1, 1, 2, 2); // return 11
numMatrix.sumRegion(1, 2, 2, 4); // return 12 
```

Constraints:
- 0 <= row1 <= row2 < m
- 0 <= col1 <= col2 < n

## Solution
> 定理：对于nums=[1,2,3], presum=[0,1,3,6]
>
>**presum[j] - presum[i] = sum(nums[i:j])**  
>
>**左闭右开**区间[i,j)的和就是前缀和数组 presum[j] - presum[i]的值,注意这里的pre_sum为了可以计算第一个数字，左边增添了一位。 


#### 1. 求presum
把`self.presum`比原矩阵 matrix 多一行一列，这样第 0 行与第 0 列的元素也能使用上面的递推公式。
presum[i][j] 表示 [0,0](包括0,0) 到 [i-1,j-1](包括i-1,j-1)的子矩形所有元素的和
![](https://raw.githubusercontent.com/emmableu/image/master/304-0.png)
`presum[i][j]=presum[i−1][j]+presum[i][j−1]−preSum[i−1][j−1]+matrix[i-1][j-1]`    
也就是
`presum[i+1][j+1]=presum[i][j+1]+presum[i+1][j]−preSum[i][j]+matrix[i][j]`    

#### 2.根据presum求子矩形面积
![](https://raw.githubusercontent.com/emmableu/image/master/304-1.png)
注意，在一维中， 前缀和数组 presum[j] - presum[i]的值是左闭右开区间[i,j)的和，所以这里我们 令end row (r) = row2 + 1, end column (c)= col2 + 1  
sumRegion return `self.presum[r][c] - self.presum[row1][c] - self.presum[r][col1] + self.presum[row1][col1]`


```python
class NumMatrix:
    def __init__(self, matrix: List[List[int]]):
        m, n = len(matrix), len(matrix[0])
        presum = [[0] * (n+1) for _ in range(m + 1)] 
        for i in range(m): #注意一定要从m=0, n=0开始
            for j in range(n):
                presum[i+1][j+1] = matrix[i][j] + presum[i][j+1] + presum[i+1][j] - presum[i][j]
        self.presum = presum

    def sumRegion(self, row1: int, col1: int, row2: int, col2: int) -> int:
        r, c = row2 + 1, col2 + 1
        return self.presum[r][c] - self.presum[row1][c] - self.presum[r][col1] + self.presum[row1][col1]
```
